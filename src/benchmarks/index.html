<html>
  <body>
    <canvas id="myChart"></canvas>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"
    integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI="
    crossorigin="anonymous"
  ></script>
  <script>
    function getRandomColor() {
      var letters = "0123456789ABCDEF";
      var color = "#";
      for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }
    function filterOutliers(someArray) {
      const avg =
        someArray.reduce((prev, curr) => (prev += curr.y), 0) /
        someArray.length;
      const filt = someArray.filter((x) => x.y < avg + 10);
      return filt;
    }
    fetch("./runs.json")
      .then((val) => val.json())
      .then((val) => {
        console.log(val);
        var ctx = document.getElementById("myChart").getContext("2d");
        var myChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: val.writes.map((x) => x.trial),
            datasets: [
              {
                borderColor: getRandomColor(),
                label: "Speed of write (ms)",
                data: filterOutliers(
                  val.writes.map((x) => ({ x: x.trial, y: x.speed }))
                ),
              },
              {
                borderColor: getRandomColor(),
                label: "Speed of read (ms)",
                data: filterOutliers(
                  val.reads.map((x) => ({ x: x.trial, y: x.speed }))
                ),
              },
            ],
          },
          options: {
            scales: {
              yAxes: [
                {
                  ticks: {
                    // stepSize: 0.01,
                    precision: 3,
                    // beginAtZero: true,
                  },
                },
              ],
            },
          },
        });
      });
  </script>
</html>
